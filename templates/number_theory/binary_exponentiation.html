<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Binary Power Glow — GSAP-first Visualizer</title>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/CustomEase.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0d1117; /* deep */
      --card:#0f1720;
      --cyan:#00f0ff;
      --lime:#7ef29a;
      --mag:#ff5ecf;
      --muted:rgba(255,255,255,0.6);
    }

    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; padding:28px; font-family:Inter, system-ui, -apple-system; background:var(--bg); color:#e6fbff; display:flex; align-items:center; justify-content:center;
    }

    /* single card centered */
    .card{
      width:980px; max-width:96vw; border-radius:16px; padding:22px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px solid rgba(255,255,255,0.03); box-shadow: 0 30px 60px rgba(2,6,23,0.6);
    }

    .header{display:flex; align-items:center; justify-content:space-between; gap:12px}
    h1{font-family:Inter; font-weight:800; font-size:20px; margin:0}
    .sub{color:var(--muted); font-size:13px}

    .stage{display:flex; gap:20px; margin-top:18px; align-items:flex-start}

    /* canvas area */
    .canvas-wrap{flex:1; position:relative; min-height:420px; display:flex; align-items:center; justify-content:center}
    canvas{width:100%; height:420px; border-radius:12px; background:linear-gradient(180deg,#071021, #05131b); display:block}

    /* overlay HUD */
    .hud{position:absolute; left:20px; top:20px; display:flex; gap:10px; align-items:center}
    .pill{background:rgba(255,255,255,0.02); padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,0.03); font-weight:700}

    /* right column controls & visuals */
    .panel{width:320px; min-width:240px}
    .controls{display:flex; gap:8px; align-items:center; margin-bottom:12px}
    input[type=number]{width:120px; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}
    button{padding:10px 12px; border-radius:10px; border:none; background:linear-gradient(90deg,var(--cyan),var(--mag)); color:#071217; font-weight:800; cursor:pointer}
    .ghost{background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); font-weight:700}

    .big-box{margin-top:12px; padding:14px; border-radius:12px; background:linear-gradient(90deg, rgba(0,240,255,0.02), rgba(126,242,154,0.02)); border:1px solid rgba(255,255,255,0.02)}
    .big-box h3{margin:0 0 6px 0; font-size:14px}
    .value{font-family: 'JetBrains Mono', monospace; font-size:20px; font-weight:700}

    /* bits row below canvas as DOM elements for GSAP stagger */
    .bits-row{position:absolute; bottom:18px; left:18px; right:18px; display:flex; gap:8px; justify-content:center; pointer-events:none}
    .bit{width:44px; height:56px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:800; color:#bffcff; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); box-shadow:0 6px 20px rgba(0,0,0,0.4)}
    .bit.on{background:linear-gradient(90deg, rgba(126,242,154,0.12), rgba(0,240,255,0.06)); color:#021211; box-shadow:0 10px 30px rgba(0,240,255,0.08)}

    /* explanation box */
    .explain{margin-top:12px; color:var(--muted); font-size:13px; min-height:60px}

    /* final reveal */
    .final-reveal{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none}
    .reveal-card{padding:22px 28px; border-radius:16px; background:linear-gradient(90deg, rgba(0,240,255,0.06), rgba(255,94,207,0.04)); border:1px solid rgba(255,255,255,0.04); transform:scale(0.8); opacity:0}
    .reveal-card .val{font-family:'JetBrains Mono', monospace; font-size:28px; font-weight:800}

    /* responsive */
    @media (max-width:980px){ .stage{flex-direction:column} .panel{width:100%}}

  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <div>
        <h1>Binary Power Glow</h1>
        <div class="sub">Simplified visual explanation with heavy GSAP animation (auto-play)</div>
      </div>
      <div style="display:flex; gap:8px; align-items:center">
        <div class="pill">O(log n) • Interactive</div>
      </div>
    </div>

    <div class="stage">
      <div class="canvas-wrap">
        <canvas id="stage" width="900" height="420"></canvas>

        <div class="hud">
          <div class="pill">Base <strong id="hudA">2</strong></div>
          <div class="pill">Result <strong id="hudR">1</strong></div>
        </div>

        <div class="bits-row" id="bitsRow" aria-hidden="false"></div>

        <div class="final-reveal" id="finalReveal">
          <div class="reveal-card" id="revealCard"><div style="color:var(--muted);font-size:14px">Final Result</div><div class="val" id="finalVal">—</div></div>
        </div>

      </div>

      <aside class="panel">
        <div class="controls">
          <input id="inputA" type="number" value="2" min="1" aria-label="base">
          <input id="inputB" type="number" placeholder="exponent e.g. 13" aria-label="exponent">
          <button id="start">Start</button>
        </div>

        <div class="big-box">
          <h3>Current Power</h3>
          <div class="value" id="powerBox">2</div>
        </div>

        <div class="big-box" style="margin-top:10px">
          <h3>Result</h3>
          <div class="value" id="resultBox">1</div>
        </div>

        <div class="explain" id="explain">Click <strong>Start</strong> — bits will appear with animated explanation and the boxes will update dynamically.</div>

        <div style="margin-top:12px; display:flex; gap:8px">
          <button id="replay" class="ghost">Replay</button>
          <button id="reset" class="ghost">Reset</button>
        </div>

      </aside>
    </div>
  </div>

  <script>
    /* ======================
       GSAP-first simplified visualizer
       - Auto-play timeline
       - Stagger bits reveal
       - Animated boxes for base & result
       - Final reveal card
       ======================*/

    const canvas = document.getElementById('stage');
    const ctx = canvas.getContext('2d');
    const bitsRow = document.getElementById('bitsRow');
    const inputA = document.getElementById('inputA');
    const inputB = document.getElementById('inputB');
    const startBtn = document.getElementById('start');
    const powerBox = document.getElementById('powerBox');
    const resultBox = document.getElementById('resultBox');
    const hudA = document.getElementById('hudA');
    const hudR = document.getElementById('hudR');
    const explain = document.getElementById('explain');
    const finalReveal = document.getElementById('finalReveal');
    const revealCard = document.getElementById('revealCard');
    const finalVal = document.getElementById('finalVal');
    const replayBtn = document.getElementById('replay');
    const resetBtn = document.getElementById('reset');

    const BIT_COUNT = 32;
    let bits = new Array(BIT_COUNT).fill(0);
    let tl = null;

    function fitCanvas(){
      const ratio = window.devicePixelRatio || 1;
      const w = canvas.clientWidth; const h = canvas.clientHeight;
      canvas.width = Math.floor(w * ratio); canvas.height = Math.floor(h * ratio);
      ctx.setTransform(ratio,0,0,ratio,0,0);
    }

    function drawAura(){
      fitCanvas();
      const w = canvas.clientWidth; const h = canvas.clientHeight;
      ctx.clearRect(0,0,w,h);
      // subtle radial glow background
      const g = ctx.createRadialGradient(w*0.5, h*0.35, 40, w*0.5, h*0.35, Math.max(w,h));
      g.addColorStop(0, 'rgba(0,240,255,0.04)'); g.addColorStop(0.4, 'rgba(126,242,154,0.02)'); g.addColorStop(1, 'rgba(255,94,207,0.01)');
      ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

      // base/result cards drawn subtly behind DOM boxes
      // left (base)
      const cw = 160, ch = 80;
      ctx.fillStyle = 'rgba(255,255,255,0.02)'; ctx.fillRect(60, 60, cw, ch);
      ctx.strokeStyle = 'rgba(0,240,255,0.06)'; ctx.strokeRect(60, 60, cw, ch);
      ctx.fillStyle = '#bffcff'; ctx.font = '700 18px "JetBrains Mono"'; ctx.fillText('Base', 72, 84);

      // right (result)
      ctx.fillStyle = 'rgba(255,255,255,0.02)'; ctx.fillRect(w - 220, 60, cw, ch);
      ctx.strokeStyle = 'rgba(255,94,207,0.06)'; ctx.strokeRect(w - 220, 60, cw, ch);
      ctx.fillStyle = '#ffd1f3'; ctx.font = '700 18px "JetBrains Mono"'; ctx.fillText('Result', w - 208, 84);
    }

    function buildBits(){
      bitsRow.innerHTML = '';
      for(let i=0;i<BIT_COUNT;i++){
        const el = document.createElement('div'); el.className = 'bit'; el.dataset.idx = i; el.textContent = bits[i];
        bitsRow.appendChild(el);
      }
    }

    function bitsFromNumber(n){ bits = new Array(BIT_COUNT).fill(0); let i=0; let nn = n; while(nn>0 && i<BIT_COUNT){ bits[i] = nn & 1; nn >>= 1; i++; } buildBits(); }

    function updateBoxes(a, r){ powerBox.textContent = String(a); resultBox.textContent = String(r); hudA.textContent = String(a); hudR.textContent = String(r); }

    function resetState(){
      bits = new Array(BIT_COUNT).fill(0); buildBits(); drawAura(); updateBoxes(2,1); finalVal.textContent = '—'; gsap.set(revealCard, {scale:0.8, opacity:0}); gsap.set(finalReveal, {pointerEvents:'none'});
      explain.textContent = 'Click Start — bits will appear with animated explanation and the boxes will update dynamically.';
      if(tl){ tl.pause(0); tl.kill(); tl = null; }
    }

    function createTimeline(a,b){
      if(tl){ tl.kill(); tl = null; }
      const A = BigInt(a); let R = 1n; let exp = BigInt(b);

      updateBoxes(A.toString(), R.toString());
      bitsFromNumber(Number(b));

      // GSAP timeline
      tl = gsap.timeline({defaults:{ease:'power2.out'}});

      // step 1: reveal bits left->right using stagger with glow
      tl.to('.bit', {duration:0.42, y:-6, opacity:1, stagger:{each:0.06, from:'start'}, onStart:()=>{ explain.textContent = 'Binary representation of exponent (LSB on the right). Bits animate in.' }});

      // iterate through bits LSB -> MSB
      let idx = 0;
      // we'll capture a snapshot of bits since we'll update them visually
      let expCopy = exp;
      while(expCopy > 0n){
        const bit = Number(expCopy & 1n);
        const bitElIndex = idx; // bits are LSB first in our DOM order

        // highlight bit pulse
        tl.to(bitsRow.children[bitElIndex], {scale:1.14, boxShadow:'0 10px 30px rgba(0,240,255,0.12)', duration:0.28, yoyo:true, repeat:1, onStart:()=>{ explain.textContent = `Reading bit ${idx} (LSB=${idx}): ${bit} — ${bit? 'Will multiply': 'Skip multiply'}` }}, '+=0.06');

        if(bit === 1){
          // multiplication animation: result box grows & flashes
          tl.to(resultBox, {scale:1.08, duration:0.26, yoyo:true, repeat:1, onStart:()=>{
            // multiply R *= A
            R = R * A;
            updateBoxes(A.toString(), R.toString());
            explain.textContent = `Bit ${idx} == 1 → result = result × base ⇒ ${R.toString()}`;
          }});
        }

        // square base animation
        tl.to(powerBox, {scale:1.08, duration:0.26, yoyo:true, repeat:1, onStart:()=>{
          // base = base * base
          // use BigInt
          let newA = A ** BigInt(1); // placeholder to keep A const in closure
        }});

        // actually square A for internal use and update HUD after a small delay
        tl.call(()=>{
          // square A (for display we keep growing as BigInt)
        });

        // shift exponent
        expCopy = expCopy >> 1n; idx++;
      }

      // final reveal
      tl.to({}, {duration:0.3});
      tl.add(()=>{ explain.textContent = 'Animation complete — final result revealed.' });
      tl.to(revealCard, {scale:1, opacity:1, duration:0.6, ease:'elastic.out(1,0.6)'});
      tl.add(()=>{ finalVal.textContent = R.toString(); gsap.fromTo(finalVal, {scale:0.9}, {scale:1.06, duration:0.35, yoyo:true, repeat:1}); });

      // small glow loop after finish
      tl.to(revealCard, {boxShadow:'0 20px 60px rgba(0,240,255,0.08)', duration:0.8});
    }

    // Note: to keep the animation simple & visually clear we intentionally avoid showing huge BigInt expansions in the timeline steps; we show the numeric updates in the boxes.

    // Event wiring
    startBtn.addEventListener('click', ()=>{
      const a = Number(inputA.value) || 2; const b = Number(inputB.value);
      if(!b || b < 1){ alert('Enter exponent >= 1'); return; }

      // prepare bits & UI
      bitsFromNumber(b);
      updateBoxes(a, 1);
      drawAura();

      // prepare timeline with a simple clear progression
      if(tl) { tl.kill(); tl = null; }

      // We'll build a more deterministic timeline that performs real multiplications & squaring with BigInt
      let A = BigInt(a);
      let R = 1n;
      let exp = BigInt(b);

      // reset reveal
      gsap.set(revealCard, {scale:0.8, opacity:0});

      tl = gsap.timeline({defaults:{ease:'power2.out'}});

      // reveal bits with stagger L->R (LSB on right visually but in our row LSB left for simpler animation)
      tl.to('.bit', {duration:0.42, y:-8, stagger:{each:0.06, from:'start'}, onStart:()=>{ explain.textContent = 'Showing exponent bits (LSB on the left for animation).'; }});

      let idx = 0;
      while(exp > 0n){
        const bit = Number(exp & 1n);
        const bitEl = () => bitsRow.children[idx];

        // read bit pulse
        tl.to({}, {duration:0.12, onStart:()=>{ // highlight visually
          gsap.fromTo(bitEl(), {scale:1}, {scale:1.12, duration:0.22, ease:'power1.inOut'});
          explain.textContent = `Reading bit index ${idx}: ${bit}`;
        }});

        if(bit === 1){
          // multiply
          tl.to({}, {duration:0.18, onStart:()=>{
            R = R * A; updateBoxes(A.toString(), R.toString());
            explain.textContent = `Bit ${idx} == 1 → result *= base → ${R.toString()}`;
            gsap.fromTo(resultBox, {scale:1}, {scale:1.08, duration:0.26, yoyo:true, repeat:1});
          }});
        } else {
          tl.to({}, {duration:0.18});
        }

        // square base
        tl.to({}, {duration:0.18, onStart:()=>{
          A = A * A; updateBoxes(A.toString(), R.toString());
          explain.textContent = `Square base → base = base × base`;
          gsap.fromTo(powerBox, {scale:1}, {scale:1.08, duration:0.26, yoyo:true, repeat:1});
        }});

        // move to next bit
        exp = exp >> 1n; idx++;
      }

      // final reveal
      tl.to({}, {duration:0.2});
      tl.add(()=>{ explain.textContent = 'Done! Revealing final result.' });
      tl.to(revealCard, {scale:1, opacity:1, duration:0.6, ease:'elastic.out(1,0.6)'});
      tl.add(()=>{ finalVal.textContent = R.toString(); gsap.fromTo(finalVal, {scale:0.9}, {scale:1.05, duration:0.35, yoyo:true, repeat:1}); });

      tl.play();
    });

    replayBtn.addEventListener('click', ()=>{
      if(tl) { tl.restart(); }
    });
    resetBtn.addEventListener('click', ()=>{ resetState(); });

    // initial
    resetState(); window.addEventListener('resize', drawAura);
  </script>
</body>
</html>
